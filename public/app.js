function Bird(){this.spaceFromFloor=300,this.y=height-this.spaceFromFloor,this.size=50,this.x=width+200,this.speed=15,this.highlight=!1,this.hitting=!1,this.show=function(){fill(255),this.highlight&&fill(255,0,0),rect(this.x,this.y,this.size,this.size)},this.update=function(){this.x-=this.speed},this.offScreen=function(){return this.x+this.size<=0},this.hits=function(i){return this.hitting=collideRectCircle(this.x,this.y,this.size,this.size,i.x,i.y,i.size),!!this.hitting&&(this.highlight||(i.lives-=1),this.highlight=!0,!0)}}
function Rex(i){this.size=75,this.y=height-this.size/2,this.x=250,this.velocity=0,this.gravity=1,this.lift=-15,this.lives=5,this.imageToUse=i,this.show=function(){switch(this.lives){case 5:fill(0,55,0);break;case 4:fill(0,200,0);break;case 3:fill(255,255,0);break;case 2:fill(255,140,0);break;case 1:fill(255,0,0);break;default:fill(255,0,0)}imageMode(CENTER),image(this.imageToUse,this.x,this.y)},this.update=function(){this.velocity+=this.gravity,this.y+=this.velocity,this.y>height-this.size/2&&(this.y=height-this.size/2,this.velocity=0),this.y<this.size/2&&(this.y=this.size/2,this.velocity=0)},this.jump=function(){this.y>=height-this.size/2-10&&(this.velocity+=this.lift)}}
var rex,img,spikes=[],spikesGap=90,birds=[],score=0,durationSpaceForBiggerJump=.2,output=document.getElementById("output"),pressed={};function preload(){img=loadImage("https://i.imgur.com/yHyeAw3.jpg")}function setup(){createCanvas(1500,700),rex=new Rex(img)}function restart(){alert("You lose with this score: "+score+", try again?"),birds=[],spikes=[],score=0,setup()}function draw(){background(0);for(var e=spikes.length-1;e>=0;e--){if(spikes[e].show(),spikes[e].update(),spikes[e].hits(rex)&&rex.lives<=0)return void restart();spikes[e].offScreen()&&(spikes.splice(e,1),score++)}for(e=birds.length-1;e>=0;e--){if(birds[e].show(),birds[e].update(),birds[e].hits(rex)&&rex.lives<=0)return void restart();birds[e].offScreen()&&(birds.splice(e,1),score++)}if(rex.update(),rex.show(),frameCount%spikesGap==0){var s=this.getRandomInt(1,13);s<7&&birds.push(new Bird);for(var r=0;r<s;r++)spikes.push(new Spike(r))}}function setSpikeGap(e){spikesGap=e<7?60:80}function getRandomInt(e,s){return e=Math.ceil(e),s=Math.floor(s),Math.floor(Math.random()*(s-e))+e}function makeRexJump(e,s){32==e&&rex.lives>0&&(s>durationSpaceForBiggerJump&&(rex.lift=-25),rex.jump(),rex.lift=-15)}window.onkeydown=function(e){pressed[e.which]||(pressed[e.which]=e.timeStamp)},window.onkeyup=function(e){if(pressed[e.which]){var s=(e.timeStamp-pressed[e.which])/1e3;makeRexJump(e.which,s),pressed[e.which]=0}};
function Spike(i){this.y=height,this.size=50,this.x=width+this.size*i,this.speed=15,this.highlight=!1,this.show=function(){fill(255),this.highlight&&fill(255,0,0),ellipse(this.x,this.y,this.size,this.size)},this.update=function(){this.x-=this.speed},this.offScreen=function(){return this.x+this.size<=0},this.hits=function(i){return Math.hypot(this.x-i.x,this.y-i.y)<=this.size+i.size/2&&(this.highlight||(i.size+=20,i.lives-=1),this.highlight=!0,!0)}}